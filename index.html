<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDP Gas & Costs Calculator (Zen Scenarios)</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f4f4; padding: 20px; line-height: 1.6; }
    h1 { color: #003049; }
    h2 { margin-top: 40px; color: #333; }
    .description { background: #e0f7fa; padding: 15px 20px; border-left: 5px solid #00acc1; margin-bottom: 30px; }
    .description ul { margin: 10px 0 10px 20px; }
    .description code { background-color: #f1f1f1; padding: 2px 5px; border-radius: 3px; font-family: monospace; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 25px; background: white; box-shadow: 0 0 6px rgba(0,0,0,.1); }
    th, td { padding: 10px; border: 1px solid #ccc; font-size: 14px; }
    th { background-color: #eceff1; color: #333; font-weight: bold; }
    .high { background-color: #ffe0e0; }
    .low  { background-color: #e0ffe0; }
    .avg  { background-color: #e0f0ff; }
    .avg2 { background-color: #f9f0ff; }
    .section-title { padding: 6px 10px; background-color: #b3e5fc; font-weight: bold; font-size: 16px; }
    input, select { padding: 5px; width: 200px; }
    .note { font-size: 13px; color: #444; }
  </style>
</head>
<body>

<h1>
  <img src="filecoin-logo.png" alt="Filecoin Logo" style="height: 35px; vertical-align: middle; margin-right: 10px;">
  PDP Gas & Costs Calculator (Zen Scenarios)
</h1>

<div class="description">
  <p>
    This calculator provides insights into Filecoin PDP gas costs, fees, and profitability.
    It supports two Zen-based scenarios with updated empirical gas measurements.
  </p>

  <p class="note">
    <b>Scenario 1:</b> 1× <code>ProvePossession</code> + 1× <code>NextProvingPeriod</code> per day (no daily <code>AddPieces</code>).<br/>
    <b>Scenario 2:</b> Scenario 1 + 1× <code>AddPieces</code> per day.
  </p>

  <p>
    Data references:
    <ul>
      <li>Old spreadsheet (Simple PDP service):
        <a href="https://docs.google.com/spreadsheets/d/1zQ8jLi_JnQk0l89ql3qRpBZjHay8IwmVte3rQi2lvvc/edit?gid=0#gid=0" target="_blank">Google Sheet</a>
      </li>
      <li>Base fee data from
        <a href="https://dashboard.starboard.ventures/dashboard/analytics#transactionsusage-network-fee" target="_blank">Starboard</a>.
      </li>
      <li>Zen measurements (FOC Gas Measurements):
        <a href="https://www.notion.so/FOC-Gas-Measurements-2e2dc41950c180368805ef76f6aa70d3?pvs=21" target="_blank">Notion doc</a>
      </li>
    </ul>
  </p>
</div>

<h2>Scenario Gas Units (Zen)</h2>
<table>
  <tr><td colspan="3" class="section-title">Updated Measurements (Gas Units)</td></tr>
  <tr>
    <th>Operation</th>
    <th>Scenario 1</th>
    <th>Scenario 2</th>
  </tr>
  <tr>
    <td><code>ProvePossession</code></td>
    <td>200,000,000</td>
    <td>200,000,000</td>
  </tr>
  <tr>
    <td><code>NextProvingPeriod</code></td>
    <td>166,000,000</td>
    <td>166,000,000</td>
  </tr>
  <tr>
    <td><code>AddPieces</code></td>
    <td>0</td>
    <td>235,000,000</td>
  </tr>
  <tr>
    <td><b>Total gas per day (1 proof/day)</b></td>
    <td><b>366,000,000</b></td>
    <td><b>601,000,000</b></td>
  </tr>
</table>

<h2>Base Fee (FIL)</h2>
<table>
  <tr><td colspan="2" class="section-title">Base Fee (FIL)</td></tr>
  <tr><th>Description</th><th>Value</th></tr>
  <tr><td>High base fee (0.1 nanoFIL)</td><td>1e-10</td></tr>
  <tr><td>Low base fee (100 attoFIL)</td><td>1e-16</td></tr>
  <tr><td>March 2025 average</td><td>5.56e-12</td></tr>
  <tr><td>30-day average (Sep 20–Oct 20 2025)</td><td>2.51e-14</td></tr>
</table>

<h2>Inputs</h2>
<table>
  <tr><th>Description</th><th>Value</th></tr>

  <tr>
    <td>Scenario</td>
    <td>
      <select id="scenario">
        <option value="S1" selected>Scenario 1 (PP + NPP)</option>
        <option value="S2">Scenario 2 (PP + NPP + AddPieces)</option>
      </select>
    </td>
  </tr>

  <tr><td>Deal price per TiB per month (USD)</td><td><input type="number" id="dealPrice" value="2.5" step="0.1"/></td></tr>
  <tr><td>FIL price (USD)</td><td><input type="number" id="filPrice" value="1.5" step="0.1"/></td></tr>

  <tr><td>Number of roots</td><td>
    <select id="roots">
      <option value="100" selected>100</option>
      <option value="1000">1000</option>
      <option value="10000">10000</option>
      <option value="100000">100000</option>
    </select>
  </td></tr>

  <tr><td>Proof set size (GiB)</td><td><input type="number" id="proofSize" value="30" step="0.01"/></td></tr>
  <tr><td>Average root size (MB)</td><td><input type="number" id="avgRootSize" readonly/></td></tr>
  <tr><td>Proofs per day</td><td><input type="number" id="proofsPerDay" value="1"/></td></tr>
  <tr><td>PDP fee per GiB per proof (FIL)</td><td><input type="number" id="pdpPerGiBPerProof" value="0.000000224609375" readonly/></td></tr>
</table>

<table>
  <tr>
    <th>Description</th>
    <th class="high">High base fee</th>
    <th class="low">Low base fee</th>
    <th class="avg">March 2025 avg base fee</th>
    <th class="avg2">30-day avg base fee (Sep 20–Oct 20 2025)</th>
  </tr>
  <tr><td>Daily gas fee (FIL)</td><td class="high" id="gasHigh"></td><td class="low" id="gasLow"></td><td class="avg" id="gasMar2025"></td><td class="avg2" id="gasAvg30d"></td></tr>
  <tr><td>Daily PDP proof fee (FIL)</td><td class="high" id="pdpHigh"></td><td class="low" id="pdpLow"></td><td class="avg" id="pdpMar2025"></td><td class="avg2" id="pdpAvg30d"></td></tr>
  <tr><td>Daily profit (FIL)</td><td class="high" id="profitHigh"></td><td class="low" id="profitLow"></td><td class="avg" id="profitMar2025"></td><td class="avg2" id="profitAvg30d"></td></tr>
  <tr><td>Daily profit (USD)</td><td class="high" id="profitUSDHigh"></td><td class="low" id="profitUSDLow"></td><td class="avg" id="profitUSDMar2025"></td><td class="avg2" id="profitUSDAvg30d"></td></tr>
  <tr><td>Monthly profit (USD)</td><td class="high" id="profitUSDMonthHigh"></td><td class="low" id="profitUSDMonthLow"></td><td class="avg" id="profitUSDMonthMar2025"></td><td class="avg2" id="profitUSDMonthAvg30d"></td></tr>
</table>

<script>
  // Scenario gas units (Zen, rounded)
  const SCENARIOS = {
    S1: { provePossession: 200000000, nextProvingPeriod: 166000000, addPieces: 0 },
    S2: { provePossession: 200000000, nextProvingPeriod: 166000000, addPieces: 235000000 }
  };

  // Base fee tiers (FIL per gas unit)
  const baseFees = { High: 1e-10, Low: 1e-16, Mar2025: 5.56e-12, Avg30d: 2.51e-14 };

  // Kept to preserve UI behavior for "average root size" — not used in gas anymore.
  const rootsForAvg = () => parseInt(document.getElementById("roots").value, 10);

  function fmt(n, d=6){ return isFinite(n) ? Number(n).toFixed(d) : "0"; }

  function calculate(){
    const scenarioKey = document.getElementById("scenario").value;
    const scenario = SCENARIOS[scenarioKey];

    const dealPrice = parseFloat(document.getElementById("dealPrice").value);
    const filPrice  = parseFloat(document.getElementById("filPrice").value);
    const roots     = rootsForAvg();
    const proofSizeGiB = parseFloat(document.getElementById("proofSize").value);
    const proofsPerDay = parseInt(document.getElementById("proofsPerDay").value, 10);
    const pdpPerGiBPerProof = parseFloat(document.getElementById("pdpPerGiBPerProof").value);

    // Average root size (MB) as integer (kept from original)
    const avgRootSizeMB = Math.round((proofSizeGiB / roots) * 1000);
    document.getElementById("avgRootSize").value = avgRootSizeMB;

    // bytes in proofset (binary)
    const bytes = proofSizeGiB * 1024 ** 3;

    // reward per byte (TiB = 2^40)
    const rewardUSD_per_byte = dealPrice / (30 * 2 ** 40);
    const rewardFIL_per_byte = rewardUSD_per_byte / filPrice;
    const rewardFIL = rewardFIL_per_byte * bytes;

    // PDP fee (per proof)
    const pdpDailyFee = pdpPerGiBPerProof * proofSizeGiB * proofsPerDay;

    // Scenario gas per day (scaled by proofs/day)
    const gasPerProof = scenario.provePossession + scenario.nextProvingPeriod + scenario.addPieces;
    const baseGas = gasPerProof * proofsPerDay;

    for (const tier in baseFees){
      const baseFee = baseFees[tier];
      const gasFee = baseFee * baseGas;

      const profitFIL = rewardFIL - gasFee - pdpDailyFee;
      const profitUSD = profitFIL * filPrice;
      const profitUSDMonth = profitUSD * 30;

      const suffix = tier === "High" ? "High" :
                     tier === "Low" ? "Low" :
                     tier === "Mar2025" ? "Mar2025" : "Avg30d";

      document.getElementById("gas" + suffix).textContent = fmt(gasFee);
      document.getElementById("pdp" + suffix).textContent = fmt(pdpDailyFee);
      document.getElementById("profit" + suffix).textContent = fmt(profitFIL);
      document.getElementById("profitUSD" + suffix).textContent = fmt(profitUSD, 4);
      document.getElementById("profitUSDMonth" + suffix).textContent = fmt(profitUSDMonth, 4);
    }
  }

  document.querySelectorAll("input, select").forEach(el => el.addEventListener("input", calculate));
  calculate();
</script>

</body>
</html>
